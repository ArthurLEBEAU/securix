(()=>{var h={sProcessing:"Traitement en cours ...",sLengthMenu:"Afficher _MENU_ lignes",sZeroRecords:"Aucun r\xE9sultat trouv\xE9",sEmptyTable:"Aucune donn\xE9e disponible",sInfo:"Lignes _START_ \xE0 _END_ sur _TOTAL_",sInfoEmpty:"Aucune ligne affich\xE9e",sInfoFiltered:"(Filtrer un maximum de_MAX_)",sInfoPostFix:"",sSearch:"Chercher:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Chargement...",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Pr\xE9c\xE9dent"},oAria:{sSortAscending:": Trier par ordre croissant",sSortDescending:": Trier par ordre d\xE9croissant"}};$(document).ready(async function(){let u="/api/service/",n=$("#serviceTable").DataTable({ajax:{url:u,cache:!0,dataSrc:"service"},language:h,data:{},contentType:"application/json",dataType:"json",pageLength:6,scrollY:"40vh",paging:!0,bAutoWidth:!1,responsive:!0,pageResize:!0,lengthChange:!0,columns:[{data:"id"},{data:"cover"},{data:"title"},{data:"created_at"},{defaultContent:'<div class="action"><button class="btn btn_update text-white"><i class="fa fa-pencil-alt"></i></button><button class="btn btn_delete text-white"><i class="fa fa-trash-alt"></i></button></div>'}],columnDefs:[{render:function(r,e,t){return`<img class='img-thumbnail img-fluid' alt='couverture du service' src='/static${r}' />`},targets:1}],createdRow:function(r,e,t,p){$(r).attr("data-id",e._id)}}),d=!0,f=!1,S=document.querySelector(".btn_create"),a=document.querySelector(".pop_frame"),_=document.querySelector(".close_btn"),b=document.querySelector(".pop_frame form"),v=document.querySelector(".pop_frame form h1"),o=document.querySelector(".pop_frame form button"),m=document.querySelector("#cover_input"),i=0,c=null;_.addEventListener("click",()=>{b.reset(),m.setAttribute("src","/static/assets/images/default_image.jpg"),a.classList.toggle("active"),i=0}),S.addEventListener("click",()=>{v.textContent="Nouveau Service",d=!0,o.textContent="enregistrer",a.classList.toggle("active")}),$(document).on("click",".btn_update",r=>{d=!1,v.textContent="Modifier un sevice",o.textContent="modifier",i=$($(r.target).closest("tr")).attr("data-id");for(let e=0;e<n.rows()[0].length;e++){let t=n.rows(e).data()[0];t._id==i&&($("#title").val(t.title),$("#cover_input").attr("src","/static"+t.cover),$("#category").val(t.categorie._id),$("#description").val(t.description))}a.classList.toggle("active")}),$(document).on("click",".btn_delete",r=>{let e=$(r.target).closest("tr"),t=$(e).attr("data-id");Swal.fire({title:"voulez vous vraiment supprimer ?",showCancelButton:!0,confirmButtonText:"Confirmer"}).then(p=>{p.isConfirmed&&$.ajax({url:u+t,method:"delete",data:{id:t},success:function(){n.row(e).remove().draw(),Swal.fire("service supprim\xE9!","","success")}})})}),$(document).on("change","#cover",r=>{c=$(r.target)[0].files[0];let e=URL.createObjectURL(c).toString();m.setAttribute("src",e)}),$("#form_modal").submit(function(r){r.preventDefault();let e=new FormData,t=$.trim($("#title").val()),p=$.trim($("#description").val()),x=$.trim($("#category").val());c==null&&d&&Swal.fire({icon:"error",title:"Oops...",text:"le fichier image ne peut pas etre vide !"}),e.append("title",t),c!=null&&e.append("cover",c),e.append("description",p),e.append("cat_id",x),d?$.ajax({url:u,method:"post",contentType:!1,processData:!1,data:e,success:function(s){o.textContent="enregistrer",f=!1,Swal.fire({icon:"success",text:"service ajout\xE9 !",showConfirmButton:!1,timer:1e3}),n.ajax.reload(null,!1),document.querySelector(".pop_frame form").reset(),m.setAttribute("src","/static/assets/images/default_image.jpg"),a.classList.toggle("active")},error:function(s){if(o.textContent="enregistrer",f=!1,s.status==422){let l="";for(let g in s.responseJSON.error)l+=`<li>${s.responseJSON.error[g]}</li>`;Swal.fire({icon:"error",title:"Oops...",html:`<ul>${l}</ul>`})}else Swal.fire({icon:"error",title:"Oops...",text:s.responseJSON.error})}}):$.ajax({url:u+i,method:"patch",contentType:!1,processData:!1,data:e,success:function(s){o.textContent="modifier",f=!1,Swal.fire({icon:"success",text:"Service modifi\xE9 !",showConfirmButton:!1,timer:1e3}),n.ajax.reload(null,!1),document.querySelector(".pop_frame form").reset(),m.setAttribute("src","/static/assets/images/default_image.jpg"),a.classList.toggle("active"),i=0},error:function(s){if(o.textContent="modifier",f=!1,s.status==422){let l="";for(let g in s.responseJSON.error)l+=`<li>${s.responseJSON.error[g]}</li>`;Swal.fire({icon:"error",title:"Oops...",html:`<ul>${l}</ul>`})}else Swal.fire({icon:"error",title:"Oops...",text:"une erreur est survenue!"})}})})});})();
